---
layout: post
categories: [cheatsheet]
share: true
comments: true
title: 'Bits, bitmasks and bit manipulations'
excerpt: 'Bit manipulation cheat sheet'
date: '2016-01-12T15:15:00+01:00'
tags: [coding]
author: maze
hidelogo: true
---

# Terminology

| Term                        | Bits     | Bytes    | [NASM][] |
|:--------------------------- |:---------|:---------|:---------|
| *nibble*                    | 4 bits   | Â½ byte   |
| *byte*                      | 8 bits   | 1 byte   | `DB`
| *word*                      | 16 bits  | 2 byte   | `DW`
| *dword* or *double word*    | 32 bits  | 4 bytes  | `DD`
| *qword* or *quad word*      | 64 bits  | 8 bytes  | `DQ`
| *tword* or *ten word*       | 80 bits  | 10 bytes | `DT`
| *oword* or *octo word*      | 128 bits | 16 bytes | `DO`
| *yword* <sup>1</sup>        | 256 bits | 32 bytes | `DY`
| *zword* <sup>2</sup>        | 512 bits | 64 bytes | `DZ`

1.  Intel [AVX](https://en.wikipedia.org/wiki/Advanced_Vector_Extensions) `YMM` register
2.  Intel [AVX-512](https://en.wikipedia.org/wiki/AVX-512) `ZZM` register

[NASM]: http://www.nasm.us

# Binary

Binary numbers, or *bits* are numbers in the *base-2* number system. "Orinary"
numbers are in *base-10*, hexadecimal numbers are in *base-16*:

{% highlight c %}
/* base-10 */
2342     = 2 * (10 ** 3) + 3 * (10 ** 2) + 4 * (10 ** 1) + 2 * (10 ** 0)  = 2342;
/* base-16 */
0x172a   = 1 * (16 ** 3) + 7 * (16 ** 2) + 2 * (16 ** 1) + 10 * (16 ** 0) = 2342;
/* base-2 */
0b101010 = 1 * ( 2 ** 5) + 1 * ( 2 ** 3) + 1 * ( 2 ** 1)                  =   42;
{% endhighlight %}

# Nibbles

A byte consists of two nibbles, or *half bytes*. A nibble contains 4 bits of
information, thus an 8 bit byte contains two nibbles.

{% highlight c %}
/*
0x0 = 0000 ; 0x4 = 0100 ; 0x8 = 1000 ; 0xc = 1100
0x1 = 0001 ; 0x5 = 0101 ; 0x9 = 1001 ; 0xd = 1101
0x2 = 0010 ; 0x6 = 0110 ; 0xa = 1010 ; 0xe = 1110
0x3 = 0011 ; 0x7 = 0111 ; 0xb = 1011 ; 0xf = 1111
*/

uint8_t msn, lsn;
/*  most significant nibble: */   msn = (x & 0xf0) >> 4;
/* least significant nibble: */   lsn = (x & 0x0f);
/*          nibbles to byte: */     x = (msn << 4) | lsn;
{% endhighlight %}

# Bit operations

{% highlight c %}
uint8_t x, y;
/*   get bit y in x: */            x &=  (1 << y);
/*   set bit y in x: */            x |=  (1 << y);  
/* unset bit y in x: */            x &= ~(1 << y);  
{% endhighlight %}

# Bit masks

{% highlight c %}
#define FEATURE_NONE    (0x00)
#define FEATURE_A       (1 << 0)
#define FEATURE_B       (1 << 1)
#define FEATURE_C       (1 << 2)
#define FEATURE_D       (1 << 3)
#define FEATURE_E       (1 << 4)
#define FEATURE_F       (1 << 5)
#define FEATURE_G       (1 << 6)
#define FEATURE_H       (1 << 7)
#define FEATURE_ALL     (0xff)

uint8_t features = FEATURE_NONE;

void enable_feature(uint8_t feature) {
    features |= feature;
}

void disable_feature(uint8_t feature) {
    features &= ~feature;
}

if (features & FEATURE_B) {
    /* ... */
}
{% endhighlight %}

# Multi byte packing

{% highlight c %}
uint8_t a, b, c, d;

/* big endian */
uint16_t  word_be = (a <<  8) | (b      );                         
uint32_t dword_be = (a << 24) | (b << 16) | (c <<  8) | (d      );

/* little endian */
uint16_t  word_be = (a      ) | (b <<  8);                         
uint32_t dword_le = (a      ) | (b <<  8) | (c << 16) | (d << 24);
{% endhighlight %}

# Working with bytes in programming languages

| Language          | Example                                        | Note
|:----------------- |:-----------------------------------------------|:-------------------------------------------------------
| C                 | `uint8_t b = 0x2a; b |= c;`                    | Masking may be required
| Java              | `static byte b = 0x2a; b |= c;`                | Guaranteed to be 8 bit byte
| PHP               | `$b = 0x2a; $b = ($b | $c) & 0xff;`            | No byte type, masking required (depends on size of `c`)
| Python            | `b = bytearray(1); b[0] = 0x2a; b[0] |= c[0];` | Guaranteed to be 8 bit byte
| Ruby              | `b = 0x2a; b = (b | c) & 0xff`                 | No byte type, masking required (depends on size of `c`)
